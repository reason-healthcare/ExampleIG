<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableAnnotations,EnableLocators" signatureLevel="None" xsi:type="a:CqlToElmInfo"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="12">
         <a:s>library LogicLibrary version '0.1.0'</a:s>
      </a:s>
   </annotation>
   <identifier id="LogicLibrary" system="http://example.org" version="0.1.0"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="3:1-3:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="5:1-5:35" localIdentifier="FHIRHelpers" path="http://example.org/FHIRHelpers" version="0.1.0">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '0.1.0'</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <valueSets>
      <def localId="3" locator="7:1-7:84" name="Sulfasalazine Medications" id="http://example.org/ValueSet/sulfasalazine-vs" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>valueset &quot;Sulfasalazine Medications&quot;: 'http://example.org/ValueSet/sulfasalazine-vs'</a:s>
            </a:s>
         </annotation>
      </def>
   </valueSets>
   <contexts>
      <def locator="9:1-9:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="9:1-9:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="9:1-9:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="12" locator="11:1-13:56" name="Sulfasalazine Order" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="12">
               <a:s>define &quot;Sulfasalazine Order&quot;:
  </a:s>
               <a:s r="11">
                  <a:s>
                     <a:s r="5">
                        <a:s r="4">
                           <a:s r="4">
                              <a:s>[MedicationRequest: </a:s>
                              <a:s>
                                 <a:s>&quot;Sulfasalazine Medications&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> SulfasalazineMedication</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
    </a:s>
                  <a:s r="10">
                     <a:s>where </a:s>
                     <a:s r="10">
                        <a:s r="7">
                           <a:s r="6">
                              <a:s>SulfasalazineMedication</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="7">
                              <a:s>status</a:s>
                           </a:s>
                        </a:s>
                        <a:s> in </a:s>
                        <a:s r="9">
                           <a:s>{ </a:s>
                           <a:s r="8">
                              <a:s>'active'</a:s>
                           </a:s>
                           <a:s> }</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="11" locator="12:3-13:56" xsi:type="Query">
            <source localId="5" locator="12:3-12:74" alias="SulfasalazineMedication">
               <expression localId="4" locator="12:3-12:50" xsi:type="Union">
                  <operand dataType="fhir:MedicationRequest" templateId="http://hl7.org/fhir/StructureDefinition/MedicationRequest" codeProperty="medication" codeComparator="in" xsi:type="Retrieve">
                     <codes locator="12:23-12:49" name="Sulfasalazine Medications" preserve="true" xsi:type="ValueSetRef"/>
                  </operand>
                  <operand locator="12:3-12:50" xsi:type="Query">
                     <source locator="12:3-12:50" alias="MR">
                        <expression dataType="fhir:MedicationRequest" templateId="http://hl7.org/fhir/StructureDefinition/MedicationRequest" xsi:type="Retrieve"/>
                     </source>
                     <relationship locator="12:3-12:50" alias="M" xsi:type="With">
                        <expression dataType="fhir:Medication" templateId="http://hl7.org/fhir/StructureDefinition/Medication" xsi:type="Retrieve"/>
                        <suchThat xsi:type="And">
                           <operand xsi:type="Equal">
                              <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <operand path="id" scope="M" xsi:type="Property"/>
                              </operand>
                              <operand xsi:type="Last">
                                 <source xsi:type="Split">
                                    <stringToSplit name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <operand path="medication.reference" scope="MR" xsi:type="Property"/>
                                    </stringToSplit>
                                    <separator valueType="t:String" value="/" xsi:type="Literal"/>
                                 </source>
                              </operand>
                           </operand>
                           <operand xsi:type="InValueSet">
                              <code name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <operand path="code" xsi:type="Property"/>
                              </code>
                              <valueset locator="12:23-12:49" name="Sulfasalazine Medications" preserve="true"/>
                           </operand>
                        </suchThat>
                     </relationship>
                  </operand>
               </expression>
            </source>
            <where localId="10" locator="13:5-13:56" xsi:type="In">
               <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand localId="7" locator="13:11-13:40" path="status" scope="SulfasalazineMedication" xsi:type="Property"/>
               </operand>
               <operand localId="9" locator="13:45-13:56" xsi:type="List">
                  <element localId="8" locator="13:47-13:54" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
      </def>
   </statements>
</library>
